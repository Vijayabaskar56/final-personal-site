---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
import { siteConfig } from "../../site.config";
---

<header
  class="group relative mb-28 flex items-center sm:ps-18"
  id="main-header"
>
  <div class="flex sm:flex-col">
    <a
      aria-current={Astro.url.pathname === "/" ? "page" : false}
      class="inline-flex items-center grayscale hover:filter-none sm:relative sm:inline-block"
      href="/"
    >
      <!-- <svg
				aria-hidden="true"
				class="me-3 h-10 w-6 sm:absolute sm:-start-18 sm:me-0 sm:h-20 sm:w-12"
				fill="none"
				focusable="false"
				viewBox="0 0 272 480"
				xmlns="http://www.w3.org/2000/svg"
			>
				<title>Logo</title>
				<path fill="#cdffb8" d="M181.334 93.333v-40L226.667 80v40zM136.001 53.333 90.667 26.667v426.666L136.001 480zM45.333 220 0 193.334v140L45.333 360z"/><path fill="#d482ab" d="M90.667 26.667 136.001 0l45.333 26.667-45.333 26.666zM181.334 53.33l45.333-26.72L272 53.33 226.667 80zM136 240l-45.333-26.67v53.34zM0 193.33l45.333-26.72 45.334 26.72L45.333 220zM181.334 93.277 226.667 120l-45.333 26.67z"/><path fill="#2abc89" d="m136 53.333 45.333-26.666v120L226.667 120V80L272 53.333V160l-90.667 53.333v240L136 480V306.667L45.334 360V220l45.333-26.667v73.334L136 240z"/>
			</svg> -->
      <svg
        aria-hidden="true"
        class="me-3 h-10 w-6 sm:absolute sm:-start-18 sm:me-0 sm:h-20 sm:w-12"
        fill="none"
        focusable="false"
        viewBox="0 0 380 680"
        xmlns="http://www.w3.org/2000/svg"
      >
        <title>Logo</title>
        <defs>
          <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow
              dx="10"
              dy="10"
              stdDeviation="8"
              flood-color="black"
              flood-opacity="0.3"></feDropShadow>
          </filter>
        </defs>
        <g filter="url(#shadow)" transform="scale(-1,1) translate(-512,0)">
          <path
            d="M237.4 462.7c-49.1-28.2-52.3-30.2-52.8-32.2-2.1-8.4-66.6-349.1-66.2-350 0.3-0.9 58.7-35.4 68.2-40.3 1.8-1 6.6 1.4 36.5 18.7 23.7 13.6 34.8 20.6 35.5 22.2 0.6 1.3 3.8 16.5 7 33.6 3.3 17.2 6.2 31.3 6.5 31.3 0.4 0 12-6.6 25.8-14.6l25.2-14.7 26.7 15.4c38.8 22.3 43.3 25 43.8 26.3 0.4 1-61.6 249.3-67.1 269.1l-1.4 5.1-34.3 19.8c-18.9 11-34.6 20.1-34.9 20.2-0.3 0.2-8.7-4.3-18.5-9.9z"
            fill="#B04304"></path>
          <path
            d="M286.2 333c18-71.2 32.7-130.3 32.7-131.4 0-1.6-6.2-5.6-30-19.3-16.6-9.5-30.3-17.2-30.5-17-0.1 0.2-7.5 29.3-16.4 64.7-8.8 35.4-16.5 65.2-17.1 66.3-1.4 2.7-5 1.9-6-1.2-0.5-1.4-8.1-40.5-16.9-87-8.9-46.5-16.5-84.9-16.9-85.3-0.4-0.4-13.6-8.2-29.2-17.2-17.8-10.3-28.5-15.9-28.7-15.1-0.4 1.8 63.6 336.8 64.5 337.7 1.9 1.9 59.9 34.8 60.8 34.5 0.6-0.1 15.7-58.5 33.7-129.7z"
            fill="#FF5D01"></path>
          <path
            d="M291.7 444.3c15-8.6 27.5-16.4 27.7-17.2 0.3-0.8 15.4-60.7 33.7-133 20.5-81.4 32.8-132 32.2-132.7-0.4-0.8-14.5-9.2-31.2-18.9-25.9-14.9-30.8-17.4-32.6-16.6-1.2 0.6-13.1 7.4-26.4 15.1-13.3 7.8-25.1 14.1-26.2 14.1-1.1 0-2.3-1-2.8-2.2-0.4-1.3-3.6-17.1-7.1-35.3-3.4-18.1-6.5-33.3-6.8-33.6-0.4-0.4-14.9-8.9-32.2-18.9-23.1-13.3-31.9-17.9-33-17.3-0.8 0.5-14.2 8.3-29.8 17.3-22.3 12.9-28 16.6-27 17.5 0.7 0.7 14 8.5 29.6 17.5 15.5 8.9 29.2 17 30.3 17.9 1.7 1.4 4.2 13.2 16.9 79.6 8.3 42.9 15 78.5 15 79 0.2 3.2 3.2-7.9 16.5-60.7 11.7-46.5 15.2-58.9 16.5-59.3 1.8-0.6 66.5 35.8 70.4 39.6 1.9 1.7 1.2 4.4-30.8 131.6-18 71.4-33 130.7-33.3 131.7-0.8 2.7-0.4 2.6 30.4-15.2z"
            fill="#53C68C"></path>
        </g>
      </svg>
      <span class="text-xl font-bold sm:text-2xl">{siteConfig.title}</span>
    </a>
    <nav
      aria-label="Main menu"
      class="bg-global-bg/85 text-accent sm:divide-accent absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md py-4 shadow backdrop-blur-sm group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
      id="navigation-menu"
    >
      {
        menuLinks.map((link) => (
          <a
            aria-current={Astro.url.pathname === link.path ? "page" : false}
            class="px-4 py-4 underline-offset-2 hover:underline sm:py-0"
            href={link.path}
          >
            {link.title}
          </a>
        ))
      }
    </nav>
  </div>
  <Search />
  <ThemeToggle />
  <mobile-button>
    <button
      aria-expanded="false"
      aria-haspopup="menu"
      class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden"
      id="toggle-navigation-menu"
      type="button"
    >
      <span class="sr-only">Open main menu</span>
      <svg
        aria-hidden="true"
        class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
        fill="none"
        focusable="false"
        id="line-svg"
        stroke="currentColor"
        stroke-width="1.5"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M3.75 9h16.5m-16.5 6.75h16.5"
          stroke-linecap="round"
          stroke-linejoin="round"></path>
      </svg>
      <svg
        aria-hidden="true"
        class="text-accent absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
        class="text-accent"
        fill="none"
        focusable="false"
        id="cross-svg"
        stroke="currentColor"
        stroke-width="1.5"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M6 18L18 6M6 6l12 12"
          stroke-linecap="round"
          stroke-linejoin="round"></path>
      </svg>
    </button>
  </mobile-button>
</header>

<script>
  import { toggleClass } from "@/utils/domElement";

  class MobileNavBtn extends HTMLElement {
    #menuOpen: boolean = false;

    connectedCallback() {
      const headerEl = document.getElementById("main-header")!;
      const mobileButtonEl = this.querySelector<HTMLButtonElement>("button");

      mobileButtonEl?.addEventListener("click", () => {
        if (headerEl) toggleClass(headerEl, "menu-open");
        this.#menuOpen = !this.#menuOpen;
        mobileButtonEl.setAttribute("aria-expanded", this.#menuOpen.toString());
      });
    }
  }

  customElements.define("mobile-button", MobileNavBtn);
</script>
